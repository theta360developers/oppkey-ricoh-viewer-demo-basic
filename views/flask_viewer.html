<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python RICOH360 Viewer Example</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
  <div style="padding: 20px">
    <div
      style="
        position: relative;
        width: 100%;
        height: 650px;
        background-color: #2a303c;">
      <div id="viewer"></div>
    </div>
  <h1>Python Example for RICOH360 Viewer</h1>
  <h2>token for viewer</h2>
  {{token}}
  <h2>Viewer Data</h2>
  <!-- {{content_data}} -->
  <div>
    <p style="text-align: center">Left Panel Scene</p>
    <ol
      id="leftList"
      style="color: black; height: 250px; overflow-y: scroll"
    ></ol>
  </div>

  <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">
    </div>
    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
    </a>
    </div>
  <script src="https://r360pf-prod-static.s3.us-west-2.amazonaws.com/viewer/v0.15.0/ricoh360-viewer.js"></script>
  <script>
  const startViewer = (initialContentId) => {
  console.log("the initial content id is " + initialContentId);
  viewer.start({
    contentId: initialContentId,
    // contentId: "c6eac34b-9bdc-4ba1-81af-29470fdead79",
    transform: "enhancement",
  });
  };
  const contentData = {{ content_data | tojson }};
  
  
    const leftList = document.getElementById("leftList");
    contentData.forEach(element => {
        if (element.status === "uploaded") {
            // console.log(data[i]);
            const listItem = document.createElement("li");
            listItem.innerHTML = `<div class="p-1">
              <img style="cursor: pointer;" src="${
                element.thumbnail_url
              }" onclick="viewer.switchScene({ contentId: '${
              element.content_id
            }'},${0})">
              <button type="button" class = "btn btn-primary mt-1" onclick="viewer.switchScene({ contentId: '${
                element.content_id
              }',transform:'enhancement'},${0})">
                Enhance
              </button>
              <button type="button" class = "btn btn-primary mt-1" onclick="viewer.switchScene({ contentId: '${
                element.content_id
              }',transform:'b_person'},${0})">
                Blur People
              </button>
              <button type="button" class = "btn btn-primary mt-1" onclick="viewer.switchScene({ contentId: '${
                element.content_id
              }',transform:'p_cubic'},${0})">
                Cubic View
              </button>
            </div>`;
            leftList.append(listItem);
          }
    });

  const fetchToken = () => "{{token}}";

  const ui = {
        cropping: {
          horizontalMargin: 15,
          verticalMargin: 75,
        },
        toolbar: {
          isHidden: false,
          cancelButton: {
            label: "Cancel",
          },
          checkButton: {
            label: "Done",
          },
          autoRotateButton: {
            isHidden: false,
            label: "Auto Rotate",
          },
          croppingButton: {
            isHidden: false,
            enterLabel: "Enter Cropping",
            exitLabel: "Exit Cropping",
          },
          annotationButton: {
            isHidden: false,
            enterLabel: "Use keyboard to annotate",
            exitLabel: "Exit keyboard annotation",
          },
          drawingButton: {
            isHidden: false,
            enterLabel: "Enter Drawing",
            exitLabel: "Exit Drawing",
          },
          fullScreenButton: {
            isHidden: false,
            enterLabel: "Enter Full Screen",
            exitLabel: "Exit Full Screen",
          },
          homePositionButton: {
            isHidden: false,
            label: "Home Position",
          },
          zoomControlButtons: {
            isHidden: false,
            zoomInLabel: "Zoom In",
            zoomOutLabel: "Zoom Out",
          },
        },
        tooltip: {
          isHidden: false,
        },
        verticalPanel: {
          isHidden: false,
          topMargin: 25,
        },
      };
      // on crop function, crops and downloads image selection
      const onCropped = async (url) => {
        const image = await fetch(url);
        const imageBlob = await image.blob();
        const imageURL = URL.createObjectURL(imageBlob);
        const downloadLink = document.createElement("a");
        downloadLink.href = imageURL;
        downloadLink.download = "cropped_image.jpeg";
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
      };

  // create new viewer with UI, fetchtoken callback function and onCrop callback function
  const viewer = new RICOH360Viewer({
  divId: "viewer",
  onFetchToken: fetchToken,
  isCubemapEnabled: true,
  ui,
  onSelected: (index) => {
    console.log("index: ", index);
  },
  onCropped: onCropped,
});
const initialContentId = contentData[0].content_id;
  startViewer(initialContentId);
  </script>
</body>
</html>